---
title: åŸå‹éˆçš„è£œå……
slug: prototype-supplement
image: ./images/image-1.png
date: 2020-01-15
author: liyo
---

# ğŸš€ ğŸ§ ğŸ“ ğŸ’«æ ¹æ“šä¸Šä¸€ç¯‡çš„[functionçš„åŸå‹éˆ](/new-function)çš„åŸå‹éˆåšé»è£œå……

## ğŸš€ ä¸Šä¸€ç¯‡æ–‡ç« æœ‰æåˆ°newé‹ç®—å­å»ºæ§‹ä¸€å€‹ç‰©ä»¶çš„éç¨‹, é€™å€‹éç¨‹å¯ä»¥çœ‹åˆ°åŸæœ¬åœ¨Ninjaä¸­çš„å¯¦ä¾‹å±¬æ€§, åœ¨newå»ºæ§‹æ™‚åˆè¢«å‰µå»ºä¸€æ¬¡, é€™åœ¨æŸäº›ç‰¹æ®Šæƒ…å½¢ä¸‹å¯èƒ½æœƒå ç”¨ç›¸ç•¶çš„è¨˜æ†¶é«”

<div className="code">

```javascript

function Ninja() {
 this.A = true; // é€™è£¡çš„thisåœ¨new Ninja()æ™‚æœƒæŒ‡å‘ninja
}; 

let ninja = new Ninja();

// æº–å‚™ä¸€å€‹ ç©ºçš„{}
// {}.[[Prototype]]è¢«æŒ‡æ´¾
// åŸ·è¡Œ {}.[[Prototype]].constructor
// ç™¼ç¾ this.A = true, thisæœƒæŒ‡å‘{}
// å‰µå»º {}.A = true
// æº–å‚™å›å‚³è¨­å®šå®Œæˆçš„{}çµ¦ninja

```

</div>

* æ¯ä¸€å€‹å¯¦ä¾‹( ninjaå€‘ )éƒ½æœƒå»ºç«‹å„è‡ªç‰ˆæœ¬çš„å±¬æ€§B, é€™æœƒå¤šå ç”¨è¨˜æ†¶é«”( å¤šå»ºç«‹3æ¬¡function ), å‡è¨­å»ºç«‹äº†å¤§é‡çš„å¯¦ä¾‹æœƒé¡¯å¾—æµªè²», é›–ç„¶ javascript å¼•æ“**æœ‰å¯èƒ½**æœƒé€²è¡Œæœ€ä½³åŒ–, å› æ­¤åªè®“ function åœ¨å‡½å¼åŸå‹ä¸Šå‡ºç¾æ˜¯ä¸éŒ¯çš„é¸æ“‡(å¦‚ prototype.func)

<div className="code">

```javascript

function Ninja() {
  this.A = 1; 
  this.B = function() {return this.A + 10}
}

Ninja.prototype.func = function() { return this.A + 1 }

let ninja = new Ninja()
let ninja2 = new Ninja()
let ninja3 = new Ninja()

// æ¯å€‹ninjaå¯¦ä¾‹æœ‰å„è‡ªç¨ç«‹çš„è³‡æ–™å±¬æ€§Aæ˜¯å¯ä»¥æ¥å—çš„( ç‰ˆæœ¬å·®ç•° )

console.log(ninja) // NinjaÂ {A: 1, B: Æ’}
console.log(ninja.B === Ninja.B) // false æ–°å‰µå»ºçš„å‡½å¼é›–ç„¶åŠŸèƒ½ä¸€æ¨£, ä½†å¤šä½”ç”¨äº†ä¸€è™•è¨˜æ†¶é«”
console.log(ninja2.func === Ninja.prototype.func) // true å› ç‚ºæ˜¯æŒ‡å‘, ä¸¦ä¸æ˜¯çœŸçš„å‰µå»º
console.log(ninja3 === Ninja) // false

```

</div>

## ğŸ’« ( å€‹äººç–‘å• ) åŸå‹éˆéæ­·å°æ•ˆèƒ½çš„å½±éŸ¿, åœ¨åŸå‹éˆæ‰¾å°‹å±¬æ€§çš„éç¨‹ä¸­, æœƒä¸€å±¤ä¸€å±¤å‘ä¸‹ç›´åˆ°æ‰¾åˆ°ç›®æ¨™æˆ–æŠµé”çµ‚é»null, å‡è¨­ä»Šå¤©æœ‰å€‹åŸå‹éˆå¾ˆé•·çš„ç‰©ä»¶, ä¸ç¢ºå®šæŸå€‹è³‡æ–™å¯¦ä¾‹å­˜ä¸å­˜åœ¨è‡ªèº«æ™‚, é‚„éœ€è¦éæ­·æ•´å€‹åŸå‹éˆå—?( é€™æ¬¡åªæƒ³çœ‹çœ‹ ninja.D å­˜ä¸å­˜åœ¨ninjaè£¡, ä¸æƒ³å¾€ä¸‹æ‰¾ä¸‹å»)

<div className="code">

```javascript

function Ninja() {
  this.A = 1;
}
Ninja.prototype.C = function() {}

let ninja = new Ninja()

console.log(ninja.A) // æ‰¾åˆ°å¯¦ä¾‹å±¬æ€§
console.log(ninja.C) // æ‰¾åˆ°åŸå‹å±¬æ€§
console.log(ninja.D) // undefined æ‰¾åˆ°çµ‚é»é‚„æ˜¯æ²’æ‰¾åˆ°

```

</div>

* ç›®å‰åªæ‰¾åˆ°Objectçš„åŸç”Ÿæ–¹æ³•hasOwnProperty, å®ƒæ˜¯Object.prototypeçš„è‡ªæœ‰å±¬æ€§, å¯ä»¥ä¸éæ­·æ•´å€‹åŸå‹éˆ, å¯ä»¥ç™¼ç¾åªæ‰¾åˆ°ç•¶å‰ä¸€ç´šè€Œå·²

<div className="code">

```javascript

function Ninja() {
  this.A = 1;
}
Ninja.prototype.C = function() {}

let ninja = new Ninja()

console.log(ninja.hasOwnProperty('A')) // true
console.log(ninja.hasOwnProperty('C')) // false
console.log(ninja.hasOwnProperty('D')) // false

```

</div>

* instanceof é‹ç®—å­, é€™å¯ä»¥æª¢æŸ¥Ninjaæ˜¯å¦å‡ºç¾åœ¨ninjaçš„åŸå‹éˆä¸Š

<div className="code">

```javascript

ninja instanceof Ninja

```

</div>

* é †å¸¶ä¸€æ, åœ¨å°‹æ‰¾å±¬æ€§æ™‚, å…ˆè¨ªå•å¯¦ä¾‹å±¬æ€§( ninja.A ) å†ä¾†è¨ªå•åŸå‹å±¬æ€§( ninja.prototype.A ), ç¨±ç‚º " property shadowing "

---

## ğŸ§ Javascriptå‹•æ…‹ç‰¹æ€§, ä½¿åŸå‹ä¹Ÿå…·å‚™å‹•æ…‹ä¿®æ”¹çš„åŠŸèƒ½, å‡è¨­Ninjaçš„åŸå‹è¢«ä¸€æ–°ç‰©ä»¶è¦†å¯« ( JSå®˜æ–¹ä¸å»ºè­°é€™éº¼åš, é€™æœ‰é»åƒMonkey Patch ), ä¹Ÿæœƒé€ æˆä¸€äº›å‰¯ä½œç”¨

<div className="code">

```javascript

function Ninja() {
  this.A = 1;
}

let ninja = new Ninja()

// å› ç‚ºæ˜¯åƒç…§æ‰€ä»¥å»ºç«‹å¯¦ä¾‹å¾Œä»å¯ä»¥è¢«å­˜å–åˆ°
Ninja.prototype.C = true

// æ­¤ç¨®è¤‡å¯«æ–¹æ³•æœƒé€£åŒprototypeä¸­çš„constructorä¸€èµ·è“‹æ‰
Ninja.prototype = {
  D: "I'm new D"
}

let ninja2 = new Ninja()

//å·²ç¶“å»ºç«‹çš„å¯¦ä¾‹ä¾èˆŠåƒç…§åˆ°èˆŠçš„Ninja
console.log(ninja.C) // true
console.log(ninja.D) // undefined 
console.log(ninja.constructor) // Æ’ Ninja()
console.log(ninja.__proto__) // {C: true, constructor: Æ’}

// æ–°å»ºç«‹çš„ninja2åƒç…§åˆ°æ–°çš„Ninja
console.log(ninja2.C) // undefined
console.log(ninja2.D) // "I'm new D" 
console.log(ninja2.constructor) // Æ’ Object() 
console.log(ninja.__proto__) // {D: "I'm new D"} ä¸¦æ²’æœ‰constructor

// å†æ¬¡ä¿®æ”¹NinjaåŸå‹ ( æ­¤æ™‚å·²æ˜¯æ–°Ninja )
Ninja.prototype.C = false

console.log(ninja.C) // true 
console.log(ninja2.C) // false

```

</div>

## ğŸ“ ç´°éƒ¨èª¿æ•´å±¬æ€§, ç‰©ä»¶ä¸­æ¯å€‹å±¬æ€§éƒ½æœ‰å€‹( property descriptor ), éœ€ä½¿ç”¨å…§å»ºObject.definePropertyåšèª¿æ•´

* configurable : ç•¶è¨­ç‚ºtrueæ™‚, ä»£è¡¨ property descriptor å¯ä»¥è¢«ä¿®æ”¹, ä¸¦ä¸”å±¬æ€§å¯ä»¥è¢«åˆªé™¤, falseæ™‚å…©å€‹å‹•ä½œéƒ½ç„¡æ³•é€²è¡Œ

* enumerable : ç•¶è¨­ç‚ºtrueæ™‚, å±¬æ€§å¯ä»¥åœ¨for-inè¢«åˆ—èˆ‰å‡ºä¾†

* value : å±¬æ€§çš„å€¼

* writable : ç•¶è¨­ç‚ºtrueæ™‚, ä»£è¡¨å¯ä»¥ç¶“ç”±è¨­å€¼æ”¹è®Šç•¶å‰å±¬æ€§çš„å€¼

* get : å®šç¾©å–å€¼å‡½å¼( getter ), ä¸èƒ½èˆ‡value, writableä¸€åŒè¨­å®š

* set : å®šç¾©è¨­å€¼å‡½å¼( setter ), ä¸èƒ½èˆ‡value, writableä¸€åŒè¨­å®š

<div className="code">

```javascript

let ninja = {}

ninja.name = "Gandalf"
// é€™ä»£è¡¨ configurable: true,
// enumerable: true,
// value: "Gandalf",
// writable: true,
// get: undefined,
// set: undefined 

```

</div>

## ğŸ§ ä»¥newé‹ç®—å­å¯¦ç¾ES6ä¹‹å‰çš„ç¹¼æ‰¿( æ²’æœ‰Classçš„æ™‚å…‰ ), ä½¿ç”¨å…§å»ºObject.definePropertyèª¿æ•´constructor

<div className="code">

```javascript

function Person() {
 this.name = "unknown"
}
Person.prototype.walk = function() { return "Can Walk" };

function Ninja() {
  this.weapon = "Frozen fish"
}
Ninja.prototype = new Person(); // é€™æœƒè¦†å¯«æ‰constructor
Ninja.prototype.run =  function() { return "Can Run" };

Object.defineProperty(Ninja.prototype, "constructor", {
 enumerable: false,
 value: Ninja, 
 writable: true
});

let ninja = new Ninja();

console.log(ninja instanceof Ninja) // true
console.log(ninja instanceof Person) // true

console.log(ninja.walk) // Æ’ () {return "Can Walk";}
console.log(ninja.name) // "unknown"
console.log(ninja.weapon) // "Frozen fish"
console.log(ninja.run) // Æ’ () {return "Can Run";}

```

</div>
